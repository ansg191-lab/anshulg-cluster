apiVersion: batch/v1
kind: CronJob
metadata:
  name: pp-tree-importer
spec:
  schedule: "*/15 * * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: pp-tree-importer
              image: ansg191/pp-tree-importer2:latest@sha256:2641036c5da92cff96a065efb52a179e89bf198390db5e2c54c9797ae9e0d798
              imagePullPolicy: IfNotPresent
              env:
                - name: GOOGLE_APPLICATION_CREDENTIALS
                  value: "/secret/credentials.json"
                - name: RUST_LOG
                  value: "info"
                - name: PP_GDRIVE_FOLDER
                  value: "1TDAKn_ud7ofTVnSQl-mjB92c3JqFvQWF"
                - name: PP_BUCKET
                  value: "pp-trees-images"
                - name: PP_LOG_FORMAT
                  value: "json"
                - name: RUST_BACKTRACE
                  value: "1"
              volumeMounts:
                - mountPath: /secret
                  name: secret
              resources:
                requests:
                  cpu: 500m
                  memory: 1Gi
                limits:
                  memory: 1536Mi
          volumes:
            - name: secret
              secret:
                secretName: pptree-secrets
          restartPolicy: OnFailure
