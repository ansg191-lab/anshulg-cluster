apiVersion: v1
kind: ConfigMap
metadata:
  name: caddy-config
data:
  Caddyfile: |
    :8080 {
      # Health check endpoint
      respond /ping "pong"
    }

    http://redacted:8080 {
      header Connection keep-alive

      reverse_proxy /* https://flacsfor.me {
        transport http {
          versions 2
          max_conns_per_host 8
          dial_timeout 5s
          response_header_timeout 10s
        }
        header_up Host {upstream_hostport}
        flush_interval -1
      }

      log {
        output stdout
        format console
        level DEBUG  # change when comfortable with setup
      }
    }
