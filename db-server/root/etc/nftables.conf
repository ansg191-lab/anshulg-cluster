#!/usr/sbin/nft -f

flush ruleset

table inet filter {
	chain input {
		type filter hook input priority filter; policy drop;
		# Drop all incoming packets by default

		iif lo accept comment "Accept loopback traffic"
		ct state invalid drop comment "Drop invalid connections"
		ct state { established, related } accept comment "Accept traffic originated from us"

		meta l4proto { icmp, ipv6-icmp } accept comment "Accept ICMP traffic"

		# mDNS (IPv4 + IPv6)
        udp dport 5353 ip daddr 224.0.0.251 accept comment "mDNS IPv4"
        udp dport 5353 ip6 daddr ff02::fb accept comment "mDNS IPv6"
        ip protocol igmp accept comment "Allow IGMP for multicast"

		tcp dport ssh accept comment "Accept SSH traffic"
		tcp dport 5432 accept comment "Accept PostgreSQL traffic"
	}
	chain forward {
		type filter hook forward priority filter; policy drop;
		# Deny all forwarded packets, we are not a router
	}
	chain output {
		type filter hook output priority filter; policy accept;
		# Accept all outgoing traffic
	}
}
